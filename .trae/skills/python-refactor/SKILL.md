---
name: python-refactor
description: 遵循架构优先、增量测试和中文注释原则的Python代码重构工具。当用户要求重构、优化代码或进行架构设计时调用。
---

# Python 重构与优化专家 (Python Refactor & Optimizer)

本技能旨在提供高质量、安全且文档完善的 Python 代码重构服务。它严格遵循"架构先行"和"测试驱动"的开发模式。

## 核心原则 (Core Principles)

1.  **架构优先 (Architecture First)**
    *   **绘图先行**: 在编写或修改任何业务逻辑代码之前，**必须**先绘制架构图（Mermaid 流程图、类图或时序图）或提供详细的架构设计文档。
    *   **设计一致性**: 代码实现必须严格遵循架构图的设计。

2.  **增量开发与测试 (Incremental Dev & Test)**
    *   **小步快跑**: 严禁一次性修改大量代码。
    *   **修改即测试**: 每次修改一定量的代码（如一个函数、一个类方法）后，**必须**立即运行测试验证。
    *   **红-绿-重构**: 确保测试通过后，才能进行下一阶段的修改。

3.  **全中文注释 (Chinese Comments)**
    *   **全面覆盖**: 所有的 Docstring、行内注释、模块说明**必须**使用中文。
    *   **语义清晰**: 注释应解释代码的意图（Why），而不仅仅是行为（What）。

4.  **依赖合规检查 (Dependency Compliance)**
    *   **API 验证**: 引入第三方依赖时，**必须**模拟 `context7mcp` 检查（或查阅官方文档），确保使用的 API 符合当前安装版本的要求。
    *   **版本锁定**: 明确记录依赖库的版本号。

## 标准工作流 (Standard Workflow)

### 第一阶段：设计 (Phase 1: Design)
1.  **理解需求**: 阅读现有代码，理解用户重构目标。
2.  **绘制架构图**: 使用 Mermaid 语法绘制重构后的系统架构或数据流图。
3.  **确认方案**: 展示架构图并简述重构计划。

### 第二阶段：执行 (Phase 2: Execution)
*循环执行以下步骤：*
1.  **Refactor**: 修改一小部分代码。
2.  **Comment**: 添加详细的**中文注释**。
3.  **Test**: 运行单元测试或编写临时脚本验证该部分功能。
4.  **Verify**: 确认测试通过。若失败，立即修复。

### 第三阶段：交付 (Phase 3: Delivery)
1.  **完整测试**: 运行所有相关测试，确保无回归错误。
2.  **清理**: 移除临时的测试脚本或调试代码。
3.  **最终确认**: 检查是否所有注释均为中文，架构是否实现。

## 示例 (Example)

**User**: "帮我重构这个数据处理脚本，使其支持多线程。"

**Agent Action**:
1.  **Draw**: 绘制多线程处理的 Mermaid 流程图（Producer-Consumer 模型）。
2.  **Step 1**: 实现 `DataProducer` 类。
    *   添加中文注释："负责从源文件读取数据..."
    *   测试 `DataProducer` 读取功能 -> Pass。
3.  **Step 2**: 实现 `DataConsumer` 类。
    *   添加中文注释："处理清洗逻辑..."
    *   测试 `DataConsumer` 处理功能 -> Pass。
4.  **Step 3**: 实现 `TaskManager` 集成多线程。
    *   验证线程池管理 -> Pass。
5.  **Finish**: 提交重构后的代码。
